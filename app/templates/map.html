<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillHub Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</head>
<body class="font-sans">

    <div class="absolute top-4 left-5 z-50 bg-white bg-opacity-90 p-2 px-3 rounded-lg flex items-center gap-2">
        <img src="{{ url_for('static', filename='icons/skillhub_logo.png') }}" alt="SkillHub Logo" class="h-8">
        <strong>SkillHub Live Map</strong>
    </div>

    <div id="map" class="h-screen w-full"></div>

    <script>
        // Initialize the map centered on Kenya
        var map = L.map('map').setView([-1.286389, 36.817223], 7);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Fetch professionals from Flask API
        fetch('/api/professionals')
            .then(response => response.json())
            .then(data => {
                data.forEach(pro => {
                    // Select icon based on profession
                    let iconUrl = '/static/icons/default.png';
                    if (pro.profession.toLowerCase().includes('electrician')) iconUrl = '/static/icons/electrician.png';
                    else if (pro.profession.toLowerCase().includes('plumber')) iconUrl = '/static/icons/plumber.png';
                    else if (pro.profession.toLowerCase().includes('mechanic')) iconUrl = '/static/icons/mechanic.png';
                    else if (pro.profession.toLowerCase().includes('developer')) iconUrl = '/static/icons/developer.png';
                    else if (pro.profession.toLowerCase().includes('designer')) iconUrl = '/static/icons/designer.png';

                    // Create custom icon
                    var proIcon = L.icon({
                        iconUrl: iconUrl,
                        iconSize: [35, 35],
                        iconAnchor: [17, 35],
                        popupAnchor: [0, -35]
                    });

                    // Add marker to map
                    var marker = L.marker([pro.latitude, pro.longitude], { icon: proIcon })
                        .addTo(map)
                        .bindPopup(`
                            <b>${pro.name}</b><br>
                            ${pro.profession}<br>
                            ⭐ Rating: ${pro.rating || 'N/A'}
                        `);
                });
            });
    </script>
</body>
</html>
